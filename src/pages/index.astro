---
import '../styles/global.css';
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Random Image Draw</title>
  </head>
  <body
    class="min-h-screen bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-4"
  >
    <main class="w-full max-w-6xl mx-auto flex flex-col items-center gap-6">
      <div class="w-full">
        <div
          class="relative w-full aspect-4/3 min-h-[360px] max-h-[calc(100vh-8rem)] overflow-hidden flex items-center justify-center"
        >
          <img
            id="random-image"
            src=""
            alt="Random image"
            class="absolute inset-0 w-full h-full object-contain"
          />
        </div>
      </div>
      <div class="flex justify-center">
        <button
          id="random-button"
          class="px-6 py-3 bg-blue-600 dark:bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 focus:ring-offset-2 dark:focus:ring-offset-gray-900 transition-colors duration-200"
        >
          Random
        </button>
      </div>
    </main>

		<script>
			let images: string[] = [];
			let currentIndex = -1;

			function preloadAllImages() {
				for (const name of images) {
					new Image().src = `/images/${name}`;
				}
			}

			function getRandomIndex(): number {
				if (images.length <= 1) return 0;
				let index: number;
				do {
					index = Math.floor(Math.random() * images.length);
				} while (index === currentIndex);
				return index;
			}

			function showRandomImage() {
				if (images.length === 0) return;

				currentIndex = getRandomIndex();
				const imgElement = document.getElementById('random-image') as HTMLImageElement | null;
				if (!imgElement) return;

				const loader = new Image();
				loader.onload = () => imgElement.src = loader.src;
				loader.src = `/images/${images[currentIndex]}`;
			}

			async function init() {
				const response = await fetch('/images-list.json');
				images = await response.json();

				if (images.length === 0) return;

				preloadAllImages();
				showRandomImage();

				document.getElementById('random-button')?.addEventListener('click', showRandomImage);
			}

			document.addEventListener('DOMContentLoaded', init);
		</script>
	</body>
</html>
